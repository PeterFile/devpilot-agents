# 多代理架构：圆桌会议

本文档介绍编排系统中代理之间的协作架构。

## 概述

系统采用"圆桌会议"理念，代理之间分工明确。亚瑟王负责编排，高文负责决策，执行者（Codex/Gemini）负责任务执行。

## 主要代理

### ⚔️ 亚瑟王 (King Arthur) - 编排者

高层战略家和领导者。拥有编排循环，确保工作与项目愿景一致。

**位置：** `.opencode/agents/king-arthur.md`

**职责：**

- 规划和依赖分析
- 将任务委派给合适的执行者
- 质量保证和最终审批
- 项目状态同步

**原则：**

- 极简主义 (KISS)
- YAGNI（你不会需要它）
- 可验证的事实优于假设

**工具：**

- 使用 `bash` 和 `webfetch` 探索仓库
- 通过 `codeagent-wrapper` 驱动任务分发
- **绝不**直接编辑文件 — 委派实现

### 🛡️ 高文 (Gawain) - 决策骑士

圆桌会议的精密引擎。专注于低延迟、高精度的决策。

**位置：** `.opencode/agents/gawain.md`

**职责：**

- 将任务映射到执行后端
- 确定文件读写集
- 验证状态转换

**协议：**

- 仅输出严格的 JSON
- 零废话，事实推理
- 不进行文件编辑或命令执行（工具已禁用）

**协同：**
当亚瑟王确定需要委派时，高文提供技术映射：

- 哪个代理（codex/gemini/codex-review）
- 哪个窗口（tmux 会话）
- 关键程度（标准/复杂/安全敏感）

---

## 执行代理

编排器利用专业后端进行执行：

| 代理         | 后端           | 专长                       |
| ------------ | -------------- | -------------------------- |
| **Codex**    | `codex`        | 实现、复杂逻辑、重构       |
| **Gemini**   | `gemini`       | UI/UX、组件样式、前端逻辑  |
| **Reviewer** | `codex-review` | 属性测试、代码审计、覆盖率 |

---

## 质量门禁

圆桌会议执行强制标准：

### 1. 状态机

任务按定义的状态推进：

```
not_started → in_progress → pending_review → under_review → completed
     ↓              ↓
  blocked ←─────────┘
```

### 2. 冲突避免

- 防止并行任务的 `writes` 重叠
- 任务声明文件依赖（`writes`/`reads`）
- 不重叠的任务并发运行

### 3. 脉搏同步

每个分发周期后，`PROJECT_PULSE.md` 会更新以反映：

- 当前任务状态
- 项目的心理模型
- 阻塞问题或需要的决策

---

## 通信流程

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   亚瑟王     │────▶│    高文      │────▶│    执行者    │
│   (编排)     │     │   (决策)     │     │   (执行)     │
└──────────────┘     └──────────────┘     └──────────────┘
       │                                         │
       └────────────── 同步 ─────────────────────┘
                  (PROJECT_PULSE.md)
```

1. **亚瑟王** 从规范中识别任务
2. **高文** 将任务映射到代理并附带文件清单
3. **执行者** 通过 `codeagent-wrapper` 并行执行
4. **亚瑟王** 整合评审并同步脉搏

---

_"圆桌会议不是关于个人能力，而是意图和执行的集体同步。"_
